<!DOCTYPE HTML>
<html>
<head>
    <title>Flask-SocketIO Test</title>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
    <script type="text/javascript">

var TIMESTAMP = 'tim';

var ACCELEROMETER = 'acc';  // Same as Acceleration including gravity
var GYROSCOPE = 'gyr'; // Same as Rotation Rate
var MAGNETOMETER = 'mag';
var GRAVITY = 'gra';
var LINEAR_ACCELERATION = 'lac';  // Same as Acceleration
var ORIENTATION = 'ori';  // Same as DeviceOrientation

var DATA = {};

DATA[TIMESTAMP]=0
DATA[ACCELEROMETER]=[]
DATA[GYROSCOPE]=[]
DATA[MAGNETOMETER]=[]
DATA[GRAVITY]=[]
DATA[LINEAR_ACCELERATION]=[]
DATA[ORIENTATION]=[]

$(document).ready(function(){
if(window.DeviceMotionEvent){
		window.addEventListener("devicemotion", motion, false);
	}else{
		var err = "DeviceMotionEvent is not supported";
		console.log(err);
		$("#accelerationIncludingGravityValues").text(err);

		$("#accelerationValues").text(err);

		$("#rotationRateValues").text(err);
	}
	function motion(event){
		var aIg = "accelerationIncludingGravity: <br>"
		+ event.accelerationIncludingGravity.x + ", <br>"
		+ event.accelerationIncludingGravity.y + ", <br>"
		+ event.accelerationIncludingGravity.z;
		console.log(aIg);
		$("#accelerationIncludingGravityValues").html(aIg);
		DATA[ACCELEROMETER]=[event.accelerationIncludingGravity.x,
		                    event.accelerationIncludingGravity.y,
		                    event.accelerationIncludingGravity.z]


		var a = "acceleration: <br>"
		+ event.acceleration.x + ",<br> "
		+ event.acceleration.y + ",<br> "
		+ event.acceleration.z;
		console.log(a);
		$("#accelerationValues").html(a);
		DATA[LINEAR_ACCELERATION]=[event.acceleration.x,
		                    event.acceleration.y,
		                    event.acceleration.z]

		var rR = "rotationRate: <br>"
		+ event.rotationRate.alpha + ", <br>"
		+ event.rotationRate.beta + ", <br>"
		+ event.rotationRate.gamma;
		console.log(rR);
		$("#rotationRateValues").html(rR);
		DATA[GYROSCOPE]=[event.rotationRate.alpha,
		                    event.rotationRate.beta,
		                    event.rotationRate.gamma]

	}

	if(window.DeviceOrientationEvent){
		window.addEventListener("deviceorientation", orientation, false);
	}else{
		var err2 = "DeviceOrientationEvent is not supported";
		console.log(err2);
		$("#deviceorientationValues").text(err2);
	}
	function orientation(event){
		var m = "Magnetometer: <br>"
		+ event.alpha + ", <br>"
		+ event.beta + ", <br>"
		+ event.gamma;
		console.log(m);
		$("#deviceorientationValues").html(m);
			DATA[ORIENTATION]=[event.alpha,
		                    event.beta,
		                    event.gamma]
	}
});


    </script>
     <script type="text/javascript" charset="utf-8">
    var STREAMING = false;

        $(document).ready(function(){
            namespace = '/test'; // change to an empty string to use the global namespace
            // the socket.io documentation recommends sending an explicit package upon connection
            // this is specially important when using the global namespace
            var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
            // event handler for server sent data
            // the data is displayed in the "Received" section of the page
            socket.on('my response', function(msg) {
                $('#log').text('Received #' + msg.count + ': ' + msg.data);
                console.log("Received as my response "+msg.data);
            });
            // event handler for new connections
            socket.on('connect', function() {
                socket.emit('my event', {data: 'I\'m connected!'});
            });
            $('#btnTest').click(function() {
            console.log('Button TEST CONNECTION clicked');
            socket.emit('my event', {data: 'TEST CONNECTION button was clicked'});
            });
            $('form#btnStream').submit(function( event ) {
                    STREAMING = !STREAMING;
                    var f = parseInt($( "[name='frequency']" ).val());
                    if (isNaN(f) || f<=0 || f > 20){
                        f = 0.5;
                    }
                    var freq = 1000/f ;
                    setInterval(stream, freq);
                    event.preventDefault();
            });
            stream = function(){
              if(STREAMING){
                 DATA[TIMESTAMP] = Date.now;
                 socket.emit('my event', {data: DATA});
                 }
            };
        });
    </script>
</head>
<body>
<h2>INTRODUCING SENSORS: </h2>
<div>
    <h3>accelerationIncludingGravity</h3>
    <div id="accelerationIncludingGravityValues">

    </div>
</div>
<div>
    <h3>acceleration</h3>
    <div id="accelerationValues">

    </div>
</div>
<div>
    <h3>rotationRate</h3>
    <div id="rotationRateValues">

    </div>
</div>

<div>
    <h3>deviceorientation</h3>
    <div id="deviceorientationValues">

    </div>
</div>

<h1>Flask-SocketIO Test</h1>
<h2>Send:</h2>
<div>
    <button id="btnTest">TEST CONNECTION</button>
</div>
<div>
    <form id="btnStream">
        <input type="submit" value="STREAM">
        <input type="text" name="frequency">
    </form>
</div>
<h2>Receive:</h2>
<div id="log"></div>
</body>
</html>